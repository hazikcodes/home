<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CodeDisk — Generate Python</title>

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Prism.js for Syntax Highlighting -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>

<style>
  :root{
    --bg:#0d0e12;
    --card: rgba(255,255,255,0.06);
    --accent:#6c63ff;
    --muted: rgba(255,255,255,0.65);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"Open Sans",sans-serif;
    background:radial-gradient(1200px 600px at 10% 10%, rgba(108,99,255,0.06), transparent),
               radial-gradient(900px 400px at 90% 90%, rgba(0,200,255,0.02), transparent),
               var(--bg);
    color:#fff;
    display:flex;
    flex-direction:column;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
  }

  header{
    padding:18px 22px;
    display:flex;
    align-items:center;
    gap:14px;
    border-bottom:1px solid rgba(255,255,255,0.04);
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  }
  .logo { width:44px;height:44px;border-radius:10px;
    background:linear-gradient(135deg,var(--accent),#3bb0ff);
    display:grid;place-items:center;font-weight:700;
    box-shadow:0 6px 22px rgba(108,99,255,0.12);
    font-size:18px;
  }
  header h1{font-size:18px;margin:0;font-weight:600}

  main{ padding:22px; flex:1; display:flex; flex-direction:column; gap:18px; }

  .panel{ background:var(--card); border-radius:14px; padding:18px; box-shadow:0 8px 30px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.04); }

  .code-area{
    min-height:260px;
    max-height:56vh;
    overflow:auto;
    background:rgba(0,0,0,0.2);
    border-radius:10px;
    padding:12px;
    position:relative;
  }

  pre{ margin:0; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:14px; line-height:1.5; white-space:pre; }

  .controls{ display:flex; gap:10px; margin-top:12px; align-items:center; }
  .controls .left{ flex:1; display:flex; gap:10px; align-items:center; }
  input{ width:100%; padding:12px; border-radius:10px; border:none; outline:none; font-size:15px; background:rgba(255,255,255,0.04); color:#fff; }

  .btn{ padding:11px 16px; border-radius:10px; border:none; background:var(--accent); color:white; font-weight:600; cursor:pointer; box-shadow:0 8px 18px rgba(108,99,255,0.12); }
  .btn.secondary{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); box-shadow:none; }

  /* Copy & Download visible by default; disabled state shows when no code */
  .action-row{ position:absolute; top:10px; right:10px; display:flex; gap:8px; z-index:5; }
  .small-btn{ padding:8px 12px; border-radius:8px; border:none; background:linear-gradient(90deg,var(--accent),#4f8fff); color:#fff; cursor:pointer; font-weight:600; }
  .small-btn.secondary{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }
  .small-btn:disabled{ opacity:0.45; cursor:not-allowed; filter:grayscale(0.2); }

  /* overlay popup */
  .overlay{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,0.6); z-index:99; }
  .overlay.show{ display:grid; }
  .popup{ background:rgba(255,255,255,0.06); padding:18px 20px; border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.06); }
  .loader{ width:40px;height:40px;border-radius:50%; margin:12px auto; border:5px solid rgba(255,255,255,0.12); border-top-color:var(--accent); animation:spin 1s linear infinite; }
  @keyframes spin{ to{transform:rotate(360deg)} }

  /* toast */
  .toast{ position:fixed; right:18px; bottom:18px; background:rgba(0,0,0,0.7); color:#fff; padding:10px 14px; border-radius:8px; font-size:13px; z-index:120; opacity:0; transform:translateY(8px); transition:opacity .18s, transform .18s; }
  .toast.show{ opacity:1; transform:translateY(0); }

  @media (max-width:720px){
    .code-area{ min-height:220px }
  }
</style>
</head>
<body>

<header>
  <div class="logo">CD</div>
  <h1>CodeDisk</h1>
</header>

<main>
  <section class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:600">Generated Python</div>
      <div style="font-size:13px;color:var(--muted)">Copy or download the result</div>
    </div>

    <div class="code-area" id="codeArea" aria-live="polite">
      <div class="action-row">
        <button id="copyBtn" class="small-btn" title="Copy code" aria-label="Copy code">Copy</button>
        <button id="downloadBtn" class="small-btn secondary" title="Download .py" aria-label="Download code">Download</button>
      </div>

      <pre><code id="codeBlock" class="language-python">Ask for a Python code using the input below…</code></pre>
    </div>

    <div class="controls" style="margin-top:12px">
      <div class="left">
        <input id="userInput" placeholder="Ask for a Py Code..." autocomplete="off" />
      </div>
      <div style="display:flex;gap:8px">
        <button id="generateBtn" class="btn">Generate</button>
      </div>
    </div>
  </section>
</main>

<!-- overlay popup (used while generating) -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="popup" role="status" aria-live="polite">
    <div style="font-weight:600">Generating…</div>
    <div class="loader" aria-hidden="true"></div>
    <div style="font-size:13px;color:var(--muted); margin-top:6px">Working on your request</div>
  </div>
</div>

<!-- toast -->
<div class="toast" id="toast">Copied to clipboard</div>

<script>
/*
  IMPORTANT:
  - This file intentionally does NOT include any real API key.
  - For local testing you may set API_KEY to your regenerated key here,
    but DO NOT publish the HTML or host it publicly with the key inside.
  - Best practice: run a small server/proxy that holds the key (recommended).
*/

const API_KEY = "AIzaSyBAgM_qxbBh63JnTPIFvYJpf5aMZT1eDVU"; // <- replace for local tests ONLY

const generateBtn = document.getElementById('generateBtn');
const codeBlock = document.getElementById('codeBlock');
const codeArea = document.getElementById('codeArea');
const userInput = document.getElementById('userInput');
const overlay = document.getElementById('overlay');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const toast = document.getElementById('toast');

function showToast(msg = "Copied to clipboard") {
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(()=> toast.classList.remove('show'), 1500);
}

/* disable/enable action buttons depending on whether code exists */
function setActionButtonsEnabled(enabled) {
  copyBtn.disabled = !enabled;
  downloadBtn.disabled = !enabled;
}

/* show overlay */
function showOverlay() {
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden', 'false');
}

/* hide overlay */
function hideOverlay() {
  overlay.classList.remove('show');
  overlay.setAttribute('aria-hidden', 'true');
}

/* safely set code text and highlight with Prism */
function setCodeText(text) {
  // put plain text into the code node (avoid innerHTML with user text)
  codeBlock.textContent = text;
  // Prism highlight
  if (window.Prism) Prism.highlightElement(codeBlock);
}

/* copy raw code (non-highlighted) */
async function copyCode() {
  const text = codeBlock.textContent || "";
  if (!text.trim()) {
    showToast("No code to copy");
    return;
  }
  try {
    await navigator.clipboard.writeText(text);
    showToast("Copied to clipboard");
  } catch (err) {
    // fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); showToast('Copied'); } catch(e){ showToast('Copy failed'); }
    ta.remove();
  }
}

/* download code as .py file */
function downloadCode() {
  const code = codeBlock.textContent || "";
  if (!code.trim()) { showToast("No code to download"); return; }
  const blob = new Blob([code], {type: 'text/x-python;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'generated_code.py';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* Generate: call Gemini endpoint (client-side). If you run locally for testing,
   set API_KEY variable above. Do NOT publish site with key included. */
async function generateCode() {
  const prompt = userInput.value.trim();
  if (!prompt) {
    setCodeText("Please enter a description for the Python code.");
    setActionButtonsEnabled(false);
    return;
  }

  showOverlay();
  setActionButtonsEnabled(false);

  try {
    // Build request payload for Gemini Flash Lite (example shape used earlier)
    const payload = {
      contents: [{
        role: "user",
        parts: [{
          text: `Hey Gemini,
Don't write anything else. ONLY send Python code. No explanation, no extra text.
User request: ${prompt}`
        }]
      }]
    };

    // Use fetch to the official endpoint — note: this exposes API_KEY to client if set.
    // For production, use a server-side proxy and keep the key on the server.
    const res = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key=" + encodeURIComponent(API_KEY),
      {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
      }
    );

    if (!res.ok) {
      // try to show backend error message
      const txt = await res.text();
      throw new Error(`HTTP ${res.status}: ${txt}`);
    }

    const json = await res.json();

    // try to locate returned text robustly
    const text = json?.candidates?.[0]?.content?.parts?.[0]?.text ?? json?.output?.[0]?.content?.text ?? null;

    hideOverlay();

    if (!text) {
      // show helpful debug info instead of silent failure
      setCodeText("Error: No code received from API.");
      console.error("API response:", json);
      setActionButtonsEnabled(false);
      return;
    }

    // clean common markdown fencing if present
    const cleaned = text.replace(/```(?:python)?\n?/g,'').replace(/```$/,'');

    setCodeText(cleaned);
    setActionButtonsEnabled(true);

  } catch (err) {
    hideOverlay();
    console.error(err);
    // friendly message for user + keep console error for debugging
    setCodeText("Error connecting to Server API. See console for details.");
    setActionButtonsEnabled(false);
  }
}

/* bindings */
generateBtn.addEventListener('click', generateCode);
copyBtn.addEventListener('click', copyCode);
downloadBtn.addEventListener('click', downloadCode);

/* Enter key to generate */
userInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    generateBtn.click();
  }
});

/* initial state */
setActionButtonsEnabled(false);

/* Accessibility: focus input on load */
window.addEventListener('load', () => userInput.focus());
</script>
</body>
</html>
